<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter New Password</title>
    <link rel="stylesheet" href="/css/reset-password.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>

<body>
    <section class="forgot">
        <h1>Reset Your Password</h1>
        <form action="/reset-password" method="POST">
            <input type="hidden" name="username" id="username"> <!-- username passed via query -->
            <input type="hidden" name="resetToken" id="resetToken"> <!-- reset token passed via query -->

            <label for="newPassword">New Password:</label>
            <div class="password-container">
                <input type="password" id="newPassword" name="newPassword" placeholder="Enter new password" required>
                <span class="toggle-password">
                    <i class="fa-solid fa-eye"></i>
                </span>
            </div>

            <label for="confirmPassword">Confirm Password:</label>
            <div class="password-contain">
                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Re-enter the password" required>
                <span class="toggle-pwd">
                    <i class="fa-solid fa-eye"></i>
                </span>
            </div>
            <button type="submit" id="reset-password-btn">Reset Password</button>
        </form>
    </section>
    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Get the token from the URL and set it in the hidden field
        const resetToken = getUrlParameter('token');
        if (resetToken) {
            document.getElementById('resetToken').value = resetToken;
        } else {
            alert('Invalid or missing reset token.');
        }

        const username = getUrlParameter('username');
        if (username) {
            document.getElementById('username').value = username;
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.querySelector('form').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent default form submission

            var form = event.target;
            const formData = new URLSearchParams(new FormData(form)).toString();

            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: formData,
            })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: data.error,
                        });
                    } else {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: data.message,
                        }).then(() => {
                            window.location.href = '/login';
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'An error occurred',
                        text: 'Please try again later.',
                    });
                });
        });
    </script>
</body>
<script src="/js/toggleSignup.js"></script>

</html>